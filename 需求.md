# 惯蛋记分器
这是一个iphone上运行的app，主要作用是在打惯蛋扑克牌的过程中显示双方的级别，类似于其他运动的记分程序，如 https://apps.apple.com/gb/app/gotop-scoreboard-and-timer/id1644272339 

## 惯蛋规则
参见 https://zh.wikipedia.org/wiki/%E6%8E%BC%E8%9B%8B

### 记分规则
- 每一局由多轮组成
- 每一轮打完只有取胜方能升级以及因此获得本局的最终胜利结束本局，失败方维持原来的级别
- 每一轮牌有且只有一方是庄家
  - 开局时双方都是从2开始升级，在新建一局时，指定一方为庄家
  - 如果本方是庄家，本轮没取胜，就对方升级并且下一轮对方当庄家，如果本轮本方取胜，本方就升级并且继续当庄家
- 每一轮每方依次为打：2~10,J、Q、K、A1、A2、A3（级别）
  - 就是每一方的当前级别
  - 在当前轮是本方打2~K时
    - 每一轮打完以后都会出一个结果，要记录这个结果
      - 如果对方双贡，本方升3级
      - 如果对方单贡，本方升2级
      - 如果本方自贡，本方升1级
    - 本轮打完后升级最多只能升级到A1，比如本方庄家打Q，对方双贡，按上述规则本方本应升3级，但是本方还是只能升级到A1
  - 在当前轮本方庄家打A时，即A1~A3时，本轮
    - 如果对方双贡、单贡时，本方取得本局的最终胜利，结束本局
  - 在当前轮本方打A1、A2时，本轮
    - 如果本方自贡时，本方升1级
  - 在当前轮本方庄家打A3时，本轮
    - 如果本方有下游，如本方双贡、单贡、自贡，本方本局失败，对方取得本局的最终胜利，结束本局
    
## 主要界面

### 首页
- 搜索框：过滤器，按包含的人名过滤对局列表
- 对局列表：显示本人参与的所有对局的成绩列表，每一个列表记录项包含
    - A、B两队4个对局人， 如 张三、李四 vs 王五、赵六
    - 成绩， 如 A1（胜）：J， 10：A3（胜）
    - 庄家标示：本局最后一轮的庄家
    - 点按列表项，进入一局界面
    - 将本区域向左滑动，在右边显示两个按钮
        - 再来一局：按钮，点按后带着2个队4个人的信息进入新建一局界面，一般是在一局打完后点按这个按钮重新开始新局
        - 删除：按钮，点按后删除该对局
- 来一局：按钮，按这个按钮后，进入新建一局界面

### 新建一局
- A组
    - 2个人姓名的输入框
    - 庄家标示（与B组的标示二选一）
- B组
    - 2个人姓名的输入框
    - 庄家标示（与A组的标示二选一）
- 开局按钮，直接以该组合开局，进入一局界面
- 取消按钮

### 一局
- 第1排
  - A 区 （左边）
    - 两个队友的名字
    - 当前级别
    - 本局最后一轮如果是本队打庄，就显示庄家标示
  - B 区 （右边）
    - 两个队友的名字
    - 当前级别
    - 本局最后一轮如果是本队打庄，就显示庄家标示
  - 点按A区或B区后，如果本局没有出现获胜方，弹出框，显示如下界面，按钮按下的队伍为本队
    - 双贡按钮：表示本队一个3游、一个下游，双下，对方升3级，需要向对方双方贡牌，本例A队双下，B队升3级，B队打庄
      - 如果对方当前是2~K，对方升3级，最多升级到A1
      - 如果对方当前是A1~A3,对方获得本局的最终胜利，结束本局
    - 单贡按钮：表示本队有一个下游，一个2游，有一个向对方贡牌，本例A队单下，B队升2级，B队打庄
      - 如果对方当前是2~K，对方升2级，最多升级到A1
      - 如果对方当前是A1~A3,对方获得本局的胜利，结束本局
    - 自贡按钮：表示本队有一个下游，一个上游，自贡后因为本队是上游，所以是本队为庄家，本例A队自贡，A队升一级，还是A队打庄
      - 如果本队当前是2~A2，本队升1级，还是本队打庄
      - 如果本队当前是A3，本队3次A不过，本队本局失败，对方获得本局的胜利，结束本局
- 第2排（可上下翻滚列表区域）
    - 每一轮的记录，包括
      - 该轮的A队和B队的4个人，左边是A队的信息，右边是B队的信息
      - 该轮的结果，谁胜谁负， A方双贡，或B方单贡，或A方自贡，或B方胜利
        - 如果是A方的行为就靠左边，如果是B方的行为就靠右边
      - 该轮结束以后的双发比分和庄家信息
    - 轮次列表
      - 按照轮次发生的先后从上到下排列
      - 如果轮次较多
        - 需要上下翻滚
        - 在记录一轮后自动翻滚到最下面，以显示最近的轮次
      - 选定最后一个轮次，支持向左滑动，显示删除按钮，可以将最后一轮有可能记错的记录删除，前提是已经前进到最后一个轮次
        - 删除最后一轮以后，原列表如果还有记录，则原列表的最后一项变为最后一行，具有向左滑动删除的功能
- 第3排
    - 回退按钮，显示回退当前的记分，但记分在程序内部不丢弃，后续如果向前进，还可以用
    - 前进按钮，从回退的点向前
  

## 其他需求
- 需要保存每盘、每轮的记录，即每一轮哪一方单贡、双贡、自贡，每盘在任何轮的得分可以根据这些信息计算得出，一局界面的回退和前进也依赖这些数据的支撑
- 每盘的记录需要保存到本地，可以删除，删除后，该盘的所有轮次的记录将被丢弃
- 需要提供统计功能，分析各个组合队伍的胜率，提供一个胜率表按照胜率高到低排列，胜率表中需要显示
  - 排名
  - 组合
  - 胜率
  - 盘数
- 选择swift语言+swiftui为技术栈
- 界面风格类似 @web https://apps.apple.com/gb/app/gotop-scoreboard-and-timer/id1644272339 软件的界面风格
- 中文界面
- 暂时不需要考虑数据恢复和同步
- 支持深色模式
- 适配iphone 10以后的手机和ipad，支持横屏模式
- 日志功能，主要用于debug
  - 需要增加每一轮的模型日志输出，记录当前对阵信息，以及贡牌信息和最新结果信息结果信息要包含结果的比分
  - 界面的加载和切换日志
  - 手势或鼠标行为，点按了啥、滑动了啥的日志
  - 日志要保存到一个文件(logs/guandan_game_log.txt)中
  